#!/usr/bin/env perl
use Socket;


socket (SERVEUR, PF_INET, SOCK_STREAM, getprotobyname('tcp'));
setsockopt (SERVEUR, SOL_SOCKET, SO_REUSEADDR, 1);
$mon_adresse = sockaddr_in ("7777", INADDR_ANY);
bind(SERVEUR, $mon_adresse) || die ("bind");
listen (SERVEUR, SOMAXCONN) || die ("listen");

while (accept (CLIENT, SERVEUR) || die ("accept")) {
    $pid = fork;
    if ($pid == 0) {
	$req=<CLIENT>;
	chomp($req);
	($methode,$ressource,$protocole)=split(/ /, $req);
	chop($protocole);
	print CLIENT "$methode $ressource $protocole";
	print CLIENT "error GET\n" unless $methode eq "GET";
	print CLIENT "error HTTP\n" unless $protocole eq "HTTP/1.0";

    } elsif ($pid != 0) {
      Sioux::enregistrerPID($pid);
    }
    close (CLIENT);
}
close (SERVEUR);
